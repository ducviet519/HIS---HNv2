@model System.App.Entities.HCNS.HCNS_NhanVien

@{
    var sdate = ""; var edate = "";
    var currentDate = DateTime.UtcNow.AddHours(7).ToString("yyyyMMdd");
    var limitDate = DateTime.UtcNow.AddHours(7).ToString("yyyyMM25");

    if (int.Parse(currentDate) > int.Parse(limitDate))
    {
        sdate = DateTime.UtcNow.AddHours(7).ToString("25/MM/yyyy");
        edate = DateTime.UtcNow.AddHours(7).AddMonths(1).ToString("24/MM/yyyy");
    }
    else
    {
        sdate = DateTime.UtcNow.AddHours(7).AddMonths(-1).ToString("25/MM/yyyy");
        edate = DateTime.UtcNow.AddHours(7).ToString("24/MM/yyyy");
    }

    var khoa = ViewBag.KhoaSoLieuVal;
    var KhoaSoLieu = ViewBag.KhoaSoLieu;
}

<div class="row">
    <div class="col-md-12">
        <div class="form-search">
            <div class="row">
                <div class="col-md-1 col-xs-2">
                    <label for="date_cc">Xem từ ngày</label>
                    <input type="text" id="sdate" class="form-control timepicker input-sm" value="@ViewBag.StartDate" autocomplete="off" required />
                </div>
                <div class="col-md-1 col-xs-2">
                    <label for="date_cc">đến ngày</label>
                    <input type="text" id="edate" class="form-control timepicker input-sm" value="@ViewBag.EndDate" autocomplete="off" required />
                </div>
                <div class="col-md-2 col-xs-2">
                    <label>Khoa/Phòng</label>
                    @Html.DropDownList("Department", new SelectList(ViewBag.Departments, "Key", "Value", Model.KhoaPhong), "--- Chọn khoa phòng ---", new { @class = "form-control input-sm chosen-ddl" })
                </div>
                <div class="col-md-2 col-xs-2">
                    <label>Loại nhân viên</label>
                    @Html.DropDownList("loainv", ViewBag.LoaiNV as List<SelectListItem>, new { @class = "form-control chosen-ddl input-sm" })
                </div>
                <div class="col-md-1 col-xs-3">
                    <label for="UserFullName">Nhân viên</label>
                    <input type="text" id="UserFullName" class="form-control input-sm" value="" autocomplete="off" />
                </div>
                <div class="col-md-5 col-xs-2">
                    <button type="button" id="btnSearch" class="btn btn-primary btn-sm" style="margin-top: 22px;">Tìm kiếm</button>
                    <button type="button" id="btnExport" class="btn btn-success btn-sm" style="margin-top: 22px; margin-left: 5px;">Xuất file</button>
                    @if (KhoaSoLieu.Contains(System.App.Entities.Common.StaticParams.HCNS_KiemTraKhoaSoLieu))
                    {
                        if (ViewBag.KhoaSoLieuVal == 0)
                        {
                            <button type="button" id="btnKSL" data-val="@ViewBag.KhoaSoLieuVal" class="btn btn-success btn-sm" style="margin-top: 22px; margin-left: 5px;">Chưa khóa số liệu</button>
                        }
                        else if (ViewBag.KhoaSoLieuVal == 1)
                        {
                            <button type="button" id="btnKSL" data-val="@ViewBag.KhoaSoLieuVal" class="btn btn-danger btn-sm" style="margin-top: 22px; margin-left: 5px;">Số liệu hiện đang khóa</button>
                            <button type="button" id="btnTHSL" class="btn btn-danger btn-sm" style="margin-top: 22px; margin-left: 5px;">Tổng hợp số liệu</button>
                            <button type="button" id="btnCKL" class="btn btn-danger btn-sm" style="margin-top: 22px; margin-left: 5px;">Chuyển kỳ lương</button>
                        }
                    }

                    <script type="text/javascript">
                        $(function () {
                            $("#btnKSL").click(function (e) {
                                var val = $(this).attr("data-val");

                                $.ajax({
                                    type: "POST",
                                    url: "/hcns/chamcong/Push_KhoaSoLieu",
                                    data: { status: val },
                                    success: function (data) {
                                        if (data.result == true) {
                                            $(this).callToast("success", '', 'Cập nhật thành công');
                                            window.location.reload();
                                        } else {
                                            $(this).callToast("error", '', "Đã có lỗi xảy ra trong quá trình truyền tải dữ liệu.");
                                        }
                                    }
                                });
                            });
                            $("#btnTHSL").click(function (e) {
                                $.ajax({
                                    type: "POST",
                                    url: "/hcns/chamcong/Push_TongHopSoLieu",
                                    data: { ngaybd: $("#sdate").val(), ngaykt: $("#edate").val() },
                                    success: function (data) {
                                        if (data.result == true) {
                                            $(this).callToast("success", '', 'Cập nhật thành công');
                                        } else {
                                            $(this).callToast("error", '', data.error);
                                        }
                                    }
                                });
                            });
                            $("#btnCKL").click(function (e) {
                                $.ajax({
                                    type: "POST",
                                    url: "/hcns/chamcong/ChuyenKyLuong",
                                    data: { ngaybd: $("#sdate").val(), ngaykt: $("#edate").val() },
                                    success: function (data) {
                                        if (data.result == true) {
                                            $(this).callToast("success", '', 'Cập nhật thành công');
                                        } else {
                                            $(this).callToast("error", '', data.error);
                                        }
                                    }
                                });
                            });
                        });
                    </script>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="box-table">
    <table class="table table-bordered table-hover" id="table-data" style="width: 100%;">
        <thead>
            <tr>
                <th rowspan="2" class="text-center" width="50">STT</th> <!-- STT -->
                <th rowspan="2" class="text-center" width="70">Mã NV</th> <!--UserFullCode-->
                <th rowspan="2" class="text-center">Họ và tên</th> <!--UserFullName-->
                <th rowspan="2" class="text-center">Khoa/Phòng</th> <!--Dept-->
                <th colspan="10" class="text-center">Công</th>
                <th colspan="2" class="text-center">Phụ cấp</th>
                <th colspan="2" class="text-center">Tài khoản ngân hàng</th>
                <th rowspan="2" class="text-center" width="70">CMND</th>
                <th rowspan="2" class="text-center" width="70">Số giờ LV</th>
                <th rowspan="2" colspan="2" class="text-center" width="70">Tổng suất ăn</th>
                <th rowspan="2" class="text-center">Công thực</th>
                <th rowspan="2" class="text-center">Email nhận bảng lương</th>
                <th rowspan="2" class="text-center">Công chuẩn</th>
                <th rowspan="2" class="text-center">Mã số thuế</th>
                <th rowspan="2" class="text-center">Quên chấm công</th>
                <th rowspan="2" class="text-center">Tiền phạt quên chấm công</th>
                <th rowspan="2" colspan="2" class="text-center">Nghỉ ngừng việc <br />(PD)</th>
                <th rowspan="2" colspan="2" class="text-center">Nghỉ <br />BHXH</th>
                <th rowspan="2" colspan="2" class="text-center">Nghỉ <br />KL</th>
                @*<th rowspan="2" class="text-center">Tổng công</th>
                <th rowspan="2" class="text-center">Tổng công &amp; nghỉ</th>*@
                <th rowspan="2" class="text-center">Trừ lỗi HSBA</th>
                <th rowspan="2" class="text-center">Phụ cấp đi lại</th>
                <th rowspan="2" colspan="2" class="text-center">Phụ cấp ca gãy</th>
                <th rowspan="2" class="text-center">Đang đi đào tạo dài hạn</th>
                <th rowspan="2" colspan="2" class="text-center">Quà sinh nhật</th>
                <th rowspan="2" colspan="2" class="text-center">Làm thêm ngày thường trước TĐL</th>
                <th rowspan="2" colspan="2" class="text-center">Làm thêm ngày nghỉ trước TĐL</th>
                <th rowspan="2" colspan="2" class="text-center">Làm thêm ngày Lễ trước TĐL</th>
                <th rowspan="2" colspan="2" class="text-center">Làm thêm ngày thường sau TĐL</th>
                <th rowspan="2" colspan="2" class="text-center">Làm thêm ngày nghỉ sau TĐL</th>
                <th rowspan="2" colspan="2" class="text-center">Làm thêm ngày Lễ sau TĐL</th>
                <th rowspan="2" class="text-center">Mức đóng BHXH</th>
                <th rowspan="2" class="text-center">Đoàn phí</th>
                <th rowspan="2" class="text-center">Tiền lương ngừng việc</th>
                <th rowspan="2" class="text-center">Bù trừ lương</th>
                <th rowspan="2" class="text-center">Lý do bù trừ</th>
                <th rowspan="2" class="text-center">Tạm giữ lương</th>
                <th rowspan="2" class="text-center">Khen thưởng <br /> Kỷ luật</th>
                <th rowspan="2" class="text-center">Thưởng khác</th>
                <th rowspan="2" class="text-center">Phụ cấp khác</th>
                <th rowspan="2" class="text-center">Đối chiếu</th>
                <th rowspan="2" class="text-center">Ghi chú</th>
                <th rowspan="2" colspan="2" class="text-center">Số ngày thừa</th>
                <th rowspan="2" class="text-center">Loại BHXH</th>
                <!-- 84 -->
            </tr>
            <tr>
                <!-- CÔNG -->
                <th colspan="2" width="70" class="text-center">Trước TĐL</th>
                <th colspan="2" width="70" class="text-center">Sau TĐL</th>
                <th width="70" class="text-center">Hệ số muộn</th>
                <th colspan="2" width="70" class="text-center">Tổng muộn</th>
                <th width="70" class="text-center">Hệ số sớm</th>
                <th colspan="2" width="70" class="text-center">Tổng sớm</th>
                
                <th width="120" class="text-center">Tiền phụ cấp</th>
                <th width="200" class="text-center">Diễn giải</th>
                <!-- TÀI KHOẢN -->
                <th class="text-center">MBBank</th>
                <th class="text-center">BIDV</th>
                <!---->
            </tr>
            <tr>
                <th class="text-center">1</th>
                <th class="text-center">2</th>
                <th class="text-center">3</th>
                <th class="text-center">4</th>
                <th class="text-center">5</th>
                <th class="text-center">6</th>
                <th class="text-center">7</th>
                <th class="text-center">8</th>
                <th class="text-center">9</th>
                <th class="text-center">10</th>
                <th class="text-center">11</th>
                <th class="text-center">12</th>
                <th class="text-center">13</th>
                <th class="text-center">14</th>
                <th class="text-center">15</th>
                <th class="text-center">16</th>
                <th class="text-center">17</th>
                <th class="text-center">18</th>
                <th class="text-center">19</th>
                <th class="text-center">20</th>
                <th class="text-center">21</th>
                <th class="text-center">22</th>
                <th class="text-center">23</th>
                <th class="text-center">24</th>
                <th class="text-center">25</th>
                <th class="text-center">26</th>
                <th class="text-center">27</th>
                <th class="text-center">28</th>
                <th class="text-center">29</th>
                <th class="text-center">30</th>
                <th class="text-center">31</th>
                <th class="text-center">32</th>
                <th class="text-center">33</th>
                <th class="text-center">34</th>
                <th class="text-center">35</th>
                <th class="text-center">36</th>
                <th class="text-center">37</th>
                <th class="text-center">38</th>
                <th class="text-center">39</th>
                <th class="text-center">40</th>
                <th class="text-center">41</th>
                <th class="text-center">42</th>
                <th class="text-center">43</th>
                <th class="text-center">44</th>
                <th class="text-center">45</th>
                <th class="text-center">46</th>
                <th class="text-center">47</th>
                <th class="text-center">48</th>
                <th class="text-center">49</th>
                <th class="text-center">50</th>
                <th class="text-center">51</th>
                <th class="text-center">52</th>
                <th class="text-center">53</th>
                <th class="text-center">54</th>
                <th class="text-center">55</th>
                <th class="text-center">56</th>
                <th class="text-center">57</th>
                <th class="text-center">58</th>
                <th class="text-center">59</th>
                <th class="text-center">60</th>
                <th class="text-center">61</th>
                <th class="text-center">62</th>
                <th class="text-center">63</th>
                <th class="text-center">64</th>
                <th class="text-center">65</th>
                <th class="text-center">66</th>
                <th class="text-center">67</th>
                @*<th class="text-center">68</th>
                <th class="text-center">69</th>*@
            </tr>
        </thead>
        <tfoot>
            <tr>
                <th class="text-center wsearch">1</th>
                <th class="text-center wsearch">2</th>
                <th class="text-center wsearch">3</th>
                <th class="text-center wsearch">4</th>
                <th class="text-center wsearch">5</th>
                <th class="text-center wsearch">6</th>
                <th class="text-center wsearch">7</th>
                <th class="text-center wsearch">8</th>
                <th class="text-center wsearch">9</th>
                <th class="text-center wsearch">10</th>
                <th class="text-center wsearch">11</th>
                <th class="text-center wsearch">12</th>
                <th class="text-center wsearch">13</th>
                <th class="text-center wsearch">14</th>
                <th class="text-center wsearch">15</th>
                <th class="text-center wsearch">16</th>
                <th class="text-center wsearch">17</th>
                <th class="text-center wsearch">18</th>
                <th class="text-center wsearch">19</th>
                <th class="text-center wsearch">20</th>
                <th class="text-center wsearch">21</th>
                <th class="text-center wsearch">22</th>
                <th class="text-center wsearch">23</th>
                <th class="text-center wsearch">24</th>
                <th class="text-center wsearch">25</th>
                <th class="text-center wsearch">26</th>
                <th class="text-center wsearch">27</th>
                <th class="text-center wsearch">28</th>
                <th class="text-center wsearch">29</th>
                <th class="text-center wsearch">30</th>
                <th class="text-center wsearch">31</th>
                <th class="text-center wsearch">32</th>
                <th class="text-center wsearch">33</th>
                <th class="text-center wsearch">34</th>
                <th class="text-center wsearch">35</th>
                <th class="text-center wsearch">36</th>
                <th class="text-center wsearch">37</th>
                <th class="text-center wsearch">38</th>
                <th class="text-center wsearch">39</th>
                <th class="text-center wsearch">40</th>
                <th class="text-center wsearch">41</th>
                <th class="text-center wsearch">42</th>
                <th class="text-center wsearch">43</th>
                <th class="text-center wsearch">44</th>
                <th class="text-center wsearch">45</th>
                <th class="text-center wsearch">46</th>
                <th class="text-center wsearch">47</th>
                <th class="text-center wsearch">48</th>
                <th class="text-center wsearch">49</th>
                <th class="text-center wsearch">50</th>
                <th class="text-center wsearch">51</th>
                <th class="text-center wsearch">52</th>
                <th class="text-center wsearch">53</th>
                <th class="text-center wsearch">54</th>
                <th class="text-center wsearch">55</th>
                <th class="text-center wsearch">56</th>
                <th class="text-center wsearch">57</th>
                <th class="text-center wsearch">58</th>
                <th class="text-center wsearch">59</th>
                <th class="text-center wsearch">60</th>
                <th class="text-center wsearch">61</th>
                <th class="text-center wsearch">62</th>
                <th class="text-center wsearch">63</th>
                <th class="text-center wsearch">64</th>
                <th class="text-center wsearch">65</th>
                <th class="text-center wsearch">66</th>
                <th class="text-center wsearch">67</th>
                @*<th class="text-center wsearch">68</th>
                <th class="text-center wsearch">69</th>*@
            </tr>
        </tfoot>
        <tbody></tbody>
    </table>
</div>

<script type="text/javascript">
    function onChange_CapNhatChiSo(userid, control, column) {
        var val = $(control).val();

        $.ajax({
            url: "/ChamCong/TongHopCong_CapNhatChiSo",
            type: "POST",
            dataType: "json",
            data: {
                userid: userid,
                date: $("#edate").val(),
                column: column,
                val: val
            },
            success: function (data) {
                if (data.result == true) {
                    $(this).callToast("success", '', 'Cập nhật thành công');
                } else {
                    $(this).callToast("error", '', data.errorMessage);
                }
            }
        });
    }

    $(function () {
        $(".chosen-ddl").chosen();

        $("#btnExport").click(function (e) {
            var kp = $("#Department option:selected").val();
            var loainv = $("#loainv option:selected").val();
            var ngaybd = $("#sdate").val();
            var ngaykt = $("#edate").val();
            var manv = $("#UserFullName").val();

            var url = "/hcns/chamcong/ExportExcelTongHopCong?ngaybd=" + ngaybd + "&ngaykt=" + ngaykt + "&manv=" + manv + "&kp=" + kp + "&loainv=" + loainv;
            $.ajax({
                type: "GET",
                url: url,
                success: function (data, status) {
                    window.location = url;
                }
            });
            e.preventDefault();
        });

        var _columns = [
            ///1
            { "data": {}, "class": "text-center", "width": "50px" },
            /*******************************/
            ///2
            { "data": "MA_NV", "class": "nowrap", "width": "70px" },
            /*******************************/
            ///3
            { "data": "HO_TEN", "class": "nowrap" },
            /*******************************/
            ///4
            { "data": "KHOA_PHONG", "class": "nowrap" },
            /*******************************/
            ///5
            {
                "data": {}, "render": function (data) {
                    return "<span style=\"display: none;\">" + data.CONG_TRUOC_TD_LUONG_FIX_E + "</span>" + data.CONG_TRUOC_TD_LUONG_FIX;
                }
            },

            ///6
            {
                "data": {}, "render": function (data) {
                    return "<span style=\"display: none;\">" + data.CONG_TRUOC_TD_LUONG_FIX_E + "</span>"
                        + "<input type=\"textbox\" class=\"form-control input-sm\" onChange=\"onChange_CapNhatChiSo(" + data.MA_SO_NV + ",this,'FWFE')\" value='" + data.CONG_TRUOC_TD_LUONG_FIX_E + "'>";
                }
            },
            /*******************************/
            ///7
            {
                "data": {}, "render": function (data) {
                    return "<span style=\"display: none;\">" + data.CONG_SAU_TD_LUONG_FIX_E + "</span>" + data.CONG_SAU_TD_LUONG_FIX;
                }
            },

            ///8
            {
                "data": {}, "render": function (data) {
                    return "<span style=\"display: none;\">" + data.CONG_SAU_TD_LUONG_FIX_E + "</span>"
                        + "<input type=\"textbox\" class=\"form-control input-sm\" onChange=\"onChange_CapNhatChiSo(" + data.MA_SO_NV + ",this,'LWFE')\" value='" + data.CONG_SAU_TD_LUONG_FIX_E + "'>";
                }
            },
            /*******************************/
            ///9
            { "data": "HE_SO_MUON", "class": "text-center" },
            /*******************************/
            ///10
            {
                "data": {}, "render": function (data) {
                    return "<span style=\"display: none;\">" + data.SO_PHUT_DI_MUON_E + "</span>" + data.SO_PHUT_DI_MUON_THUC;
                }
            },

            ///11
            {
                "data": {}, "render": function (data) {
                    return "<span style=\"display: none;\">" + data.SO_PHUT_DI_MUON_E + "</span>"
                        + "<input type=\"textbox\" class=\"form-control input-sm\" onChange=\"onChange_CapNhatChiSo(" + data.MA_SO_NV + ",this,'LIE')\" value='" + data.SO_PHUT_DI_MUON_E + "'>";
                }
            },
            /*******************************/
            ///12
            { "data": "HE_SO_SOM", "class": "text-center" },

            /*******************************/
            ///13: TỔNG SỚM
            {
                "data": {}, "render": function (data) {
                    return "<span style=\"display: none;\">" + data.SO_PHUT_VE_SOM_E + "</span>" + data.SO_PHUT_VE_SOM_THUC;
                }
            },

            ///14
            {
                "data": {}, "render": function (data) {
                    return "<span style=\"display: none;\">" + data.SO_PHUT_VE_SOM_E + "</span>"
                        + "<input type=\"textbox\" class=\"form-control input-sm\" onChange=\"onChange_CapNhatChiSo(" + data.MA_SO_NV + ",this,'EOE')\" value='" + data.SO_PHUT_VE_SOM_E + "'>";
                }
            },
            /*******************************/
            /////15: Phụ cấp trực ngày - đêm
            //{
            //    "data": {}, "render": function (data) {
            //        return "<span style=\"display: none;\">" + data.PHU_CAP_TRUC_E + "</span>" + data.PHU_CAP_TRUC;
            //    }
            //},

            /////16
            //{
            //    "data": {}, "render": function (data) {
            //        return "<span style=\"display: none;\">" + data.PHU_CAP_TRUC_E + "</span>"
            //            + "<input type=\"textbox\" class=\"form-control input-sm\" onChange=\"onChange_CapNhatChiSo(" + data.MA_SO_NV + ",this,'TrBE')\" value='" + data.PHU_CAP_TRUC_E + "'>";
            //    }
            //},
            ///*******************************/
            /////17: PHỤ CẤP TRỰC ĐÊM
            //{
            //    "data": {}, "render": function (data) {
            //        return "<span style=\"display: none;\">" + data.PHU_CAP_TRUC_DEM_E + "</span>" + data.PHU_CAP_TRUC_DEM;
            //    }
            //},

            /////18
            //{
            //    "data": {}, "render": function (data) {
            //        return "<span style=\"display: none;\">" + data.PHU_CAP_TRUC_DEM_E + "</span>"
            //            + "<input type=\"textbox\" class=\"form-control input-sm\" onChange=\"onChange_CapNhatChiSo(" + data.MA_SO_NV + ",this,'NBE')\" value='" + data.PHU_CAP_TRUC_DEM_E + "'>";
            //    }
            //},
            //{
            //    "data": {}, "render": function (data) {
            //        return data.PHU_CAP_TR08H;
            //    }
            //},

            {
                "data": {}, "render": function (data) {
                    return data.TienPhuCap;
                }
            },

            {
                "data": {}, "render": function (data) {
                    return data.DienGiaiPC;
                }
            },
            /*******************************/
            ///19
            {
                "data": {}, "render": function (data) {
                    if ($("#UserPermission").val() == "admin") {
                        return data.SO_TK_1;
                    } else {
                        return "-";
                    }
                }
            },
            /*******************************/
            ///20
            {
                "data": {}, "render": function (data) {
                    if ($("#UserPermission").val() == "admin") {
                        return data.SO_TK_2;
                    } else {
                        return "-";
                    }
                }
            },
            /*******************************/
            ///21
            {
                "data": {}, "render": function (data) {
                    if ($("#UserPermission").val() == "admin") {
                        return data.SO_CMT;
                    } else {
                        return "-";
                    }
                }
            },
            /*******************************/
            ///22
            { "data": "SO_GIO_LV" },
            /*******************************/
            ///23: TỔNG SUẤT ĂN
            {
                "data": {}, "render": function (data) {
                    return "<span style=\"display: none;\">" + data.TONG_SUAT_AN_E + "</span>" + data.TONG_SUAT_AN;
                }
            },

            ///24
            {
                "data": {}, "render": function (data) {
                    return "<span style=\"display: none;\">" + data.TONG_SUAT_AN_E + "</span>"
                        + "<input type=\"textbox\" class=\"form-control input-sm\" onChange=\"onChange_CapNhatChiSo(" + data.MA_SO_NV + ",this,'AE')\" value='" + data.TONG_SUAT_AN_E + "'>";
                }
            },
            /*******************************/
            ///25
            { "data": "CONG_THUC" },
            /*******************************/
            ///26
            {
                "data": {}, "render": function (data) {
                    return data.EMAIL;
                }
            },
            /*******************************/
            ///27
            {
                "data": {}, "render": function (data) {
                    return data.CONG_CHUAN;
                }
            },
            /*******************************/
            ///28
            {
                "data": {}, "render": function (data) {
                    return data.MA_SO_THUE;
                }
            },
            /*******************************/
            ///29
            {
                "data": {}, "render": function (data) {
                    return data.SO_LAN_KHONG_VR;
                }
            },
            ///30
            {
                "data": {}, "render": function (data) {
                    return data.TIEN_QUEN_CC;
                }
            },
            /*******************************/
            ///31: NGHỈ NGỪNG VIỆC
            {
                "data": {}, "render": function (data) {
                    return "<span style=\"display: none;\">" + data.NGHI_NGUNGVIEC_E + "</span>" + data.NGHI_NGUNGVIEC;
                }
            },

            ///32
            {
                "data": {}, "render": function (data) {
                    return "<span style=\"display: none;\">" + data.NGHI_NGUNGVIEC_E + "</span>"
                        + "<input type=\"textbox\" class=\"form-control input-sm\" onChange=\"onChange_CapNhatChiSo(" + data.MA_SO_NV + ",this,'PDE')\" value='" + data.NGHI_NGUNGVIEC_E + "'>";
                }
            },
            /*******************************/
            ///33: NGHỈ BHXH
            {
                "data": {}, "render": function (data) {
                    return "<span style=\"display: none;\">" + data.NGHI_BHXH_E + "</span>" + data.NGHI_BHXH;
                }
            },

            ///34
            {
                "data": {}, "render": function (data) {
                    return "<span style=\"display: none;\">" + data.NGHI_BHXH_E + "</span>"
                        + "<input type=\"textbox\" class=\"form-control input-sm\" onChange=\"onChange_CapNhatChiSo(" + data.MA_SO_NV + ",this,'BHE')\" value='" + data.NGHI_BHXH_E + "'>";
                }
            },
            /*******************************/
            ///35: NGHỈ KHÔNG LƯƠNG
            {
                "data": {}, "render": function (data) {
                    return "<span style=\"display: none;\">" + data.NGHI_KL_E + "</span>" + data.NGHI_KL;
                }
            },

            ///36
            {
                "data": {}, "render": function (data) {
                    return "<span style=\"display: none;\">" + data.NGHI_KL_E + "</span>"
                        + "<input type=\"textbox\" class=\"form-control input-sm\" onChange=\"onChange_CapNhatChiSo(" + data.MA_SO_NV + ",this,'KLE')\" value='" + data.NGHI_KL_E + "'>";
                }
            },
            /*******************************/
            ///37
            //{
            //    "data": {}, "render": function (data) {
            //        return data.TONG_CONG;
            //    }
            //},

            ///38
            //{
            //    "data": {}, "render": function (data) {
            //        return data.TONG_CONG_VA_NGHI;
            //    }
            //},

            ///39
            {
                "data": {}, "render": function (data) {
                    return "<span style=\"display: none;\">" + data.LOI_HSBA + "</span>"
                        + "<input type=\"textbox\" class=\"form-control input-sm\" onChange=\"onChange_CapNhatChiSo(" + data.MA_SO_NV + ",this,'LHS')\" value='" + data.LOI_HSBA + "'>";
                }
            },

            ///40
            {
                "data": {}, "render": function (data) {

                    return "<span style=\"display: none;\">" + data.PHU_CAP_DI_LAI + "</span>"
                        + "<input type=\"textbox\" class=\"form-control input-sm\" onChange=\"onChange_CapNhatChiSo(" + data.MA_SO_NV + ",this,'PCDL')\" value='" + data.PHU_CAP_DI_LAI + "'>";
                }
            },
            /*******************************/
            ///41: PHỤ CẤP CA GÃY
            {
                "data": {}, "render": function (data) {
                    return "<span style=\"display: none;\">" + data.PHU_CAP_CA_GAY_E + "</span>" + data.PHU_CAP_CA_GAY;
                }
            },

            ///42
            {
                "data": {}, "render": function (data) {
                    return "<span style=\"display: none;\">" + data.PHU_CAP_CA_GAY_E + "</span>"
                        + "<input type=\"textbox\" class=\"form-control input-sm\" onChange=\"onChange_CapNhatChiSo(" + data.MA_SO_NV + ",this,'PCG')\" value='" + data.PHU_CAP_CA_GAY_E + "'>";
                }
            },
            /*******************************/
            ///43
            {
                "data": {}, "render": function (data) {
                    return "<span style=\"display: none;\">" + data.DANG_DAO_TAO + "</span>"
                        + "<input type=\"textbox\" class=\"form-control input-sm\" onChange=\"onChange_CapNhatChiSo(" + data.MA_SO_NV + ",this,'DT')\" value='" + data.DANG_DAO_TAO + "'>";
                }
            },
            /*******************************/
            ///44: QUÀ SINH NHẬT
            {
                "data": {}, "render": function (data) {
                    return "<span style=\"display: none;\">" + data.QUA_SN_E + "</span>" + data.QUA_SN;
                }
            },

            ///45
            {
                "data": {}, "render": function (data) {
                    return "<span style=\"display: none;\">" + data.QUA_SN_E + "</span>"
                        + "<input type=\"textbox\" class=\"form-control input-sm\" onChange=\"onChange_CapNhatChiSo(" + data.MA_SO_NV + ",this,'SNE')\" value='" + data.QUA_SN_E + "'>";
                }
            },
            /*******************************/
            ///46: LÀM THÊM NGÀY THƯỜNG TRƯỚC THAY ĐỔI LƯƠNG
            {
                "data": {}, "render": function (data) {
                    return "<span style=\"display: none;\">" + data.NT_TRUOC_TD_LUONG_E + "</span>" + data.NT_TRUOC_TD_LUONG;
                }
            },

            ///47
            {
                "data": {}, "render": function (data) {
                    return "<span style=\"display: none;\">" + data.NT_TRUOC_TD_LUONG_E + "</span>" +
                        "<input type=\"textbox\" class=\"form-control input-sm\" onChange=\"onChange_CapNhatChiSo(" + data.MA_SO_NV + ",this,'FOvTWHE')\" value='" + data.NT_TRUOC_TD_LUONG_E + "'>";
                }
            },
            ///48: LÀM THÊM NGÀY NGHỈ TRƯỚC THAY ĐỔI LƯƠNG
            {
                "data": {}, "render": function (data) {
                    return "<span style=\"display: none;\">" + data.NN_TRUOC_TD_LUONG_E + "</span>" + data.NN_TRUOC_TD_LUONG;
                }
            },

            ///49
            {
                "data": {}, "render": function (data) {
                    return "<span style=\"display: none;\">" + data.NN_TRUOC_TD_LUONG_E + "</span>" +
                        "<input type=\"textbox\" class=\"form-control input-sm\" onChange=\"onChange_CapNhatChiSo(" + data.MA_SO_NV + ",this,'FOffWHE')\" value='" + data.NN_TRUOC_TD_LUONG_E + "'>";
                }
            },
            /*******************************/
            ///50: LÀM THÊM NGÀY LỄ TRƯỚC TĐL
            {
                "data": {}, "render": function (data) {
                    return "<span style=\"display: none;\">" + data.NL_TRUOC_TD_LUONG_E + "</span>" + data.NL_TRUOC_TD_LUONG;
                }
            },

            ///51
            {
                "data": {}, "render": function (data) {
                    return "<span style=\"display: none;\">" + data.NL_TRUOC_TD_LUONG_E + "</span>" +
                        "<input type=\"textbox\" class=\"form-control input-sm\" onChange=\"onChange_CapNhatChiSo(" + data.MA_SO_NV + ",this,'FLWHE')\" value='" + data.NL_TRUOC_TD_LUONG_E + "'>";
                }
            },
            /*******************************/
            ///52: LÀM THÊM NGÀY THƯỜNG SAU THAY ĐỔI LƯƠNG
            {
                "data": {}, "render": function (data) {
                    return "<span style=\"display: none;\">" + data.NT_SAU_TD_LUONG_E + "</span>" + data.NT_SAU_TD_LUONG;
                }
            },

            ///53
            {
                "data": {}, "render": function (data) {
                    return "<span style=\"display: none;\">" + data.NT_SAU_TD_LUONG_E + "</span>" +
                        "<input type=\"textbox\" class=\"form-control input-sm\" onChange=\"onChange_CapNhatChiSo(" + data.MA_SO_NV + ",this,'LOvTWHE')\" value='" + data.NT_SAU_TD_LUONG_E + "'>";
                }
            },
            /*******************************/
            ///54: LÀM THÊM NGÀY NGHỈ SAU THAY ĐỔI LƯƠNG
            {
                "data": {}, "render": function (data) {
                    return "<span style=\"display: none;\">" + data.NN_SAU_TD_LUONG_E + "</span>" + data.NN_SAU_TD_LUONG;
                }
            },

            ///55
            {
                "data": {}, "render": function (data) {
                    return "<span style=\"display: none;\">" + data.NN_SAU_TD_LUONG_E + "</span>" +
                        "<input type=\"textbox\" class=\"form-control input-sm\" onChange=\"onChange_CapNhatChiSo(" + data.MA_SO_NV + ",this,'LOffWHE')\" value='" + data.NN_SAU_TD_LUONG_E + "'>";
                }
            },
            /*******************************/
            ///56: LÀM THÊM NGÀY LỄ SAU THAY ĐỔI LƯƠNG
            {
                "data": {}, "render": function (data) {
                    return "<span style=\"display: none;\">" + data.NL_SAU_TD_LUONG_E + "</span>" + data.NL_SAU_TD_LUONG;
                }
            },

            ///57
            {
                "data": {}, "render": function (data) {
                    return "<span style=\"display: none;\">" + data.NL_SAU_TD_LUONG_E + "</span>" +
                        "<input type=\"textbox\" class=\"form-control input-sm\" onChange=\"onChange_CapNhatChiSo(" + data.MA_SO_NV + ",this,'LLWHE')\" value='" + data.NL_SAU_TD_LUONG_E + "'>";
                }
            },
            /*******************************/
            ///58
            {
                "data": {}, "render": function (data) {
                    return data.MUC_DONG_BHXH;
                }
            },

            ///59
            {
                "data": {}, "render": function (data) {
                    return data.DOAN_PHI;
                }
            },

            ///60
            {
                "data": {}, "render": function (data) {
                    return data.LUONG_NGUNG_VIEC;
                }
            },

            ///61
            {
                "data": {}, "render": function (data) {
                    return "<span style=\"display: none;\">" + data.BU_TRU_LUONG + "</span>" +
                        "<input type=\"textbox\" class=\"form-control input-sm\" onChange=\"onChange_CapNhatChiSo(" + data.MA_SO_NV + ",this,'BTL')\" value='" + data.BU_TRU_LUONG + "'>";
                }
            },

            ///62
            {
                "data": {}, "render": function (data) {
                    return "<span style=\"display: none;\">" + data.LYDO_BT + "</span>" +
                        "<input type=\"textbox\" class=\"form-control input-sm\" onChange=\"onChange_CapNhatChiSo(" + data.MA_SO_NV + ",this,'LyDoBT')\" value='" + data.LYDO_BT + "'>";
                }
            },

            ///63
            {
                "data": {}, "render": function (data) {
                    return "<span style=\"display: none;\">" + data.GIU_LUONG + "</span>" +
                        "<input type=\"textbox\" class=\"form-control input-sm\" onChange=\"onChange_CapNhatChiSo(" + data.MA_SO_NV + ",this,'GiuLuong')\" value='" + data.GIU_LUONG + "'>";
                }
            },
            /*******************************/

            ///64
            {
                "data": {}, "render": function (data) {
                    return "<span style=\"display: none;\">" + data.TIEN_THUONG + "</span>" +
                        "<input type=\"textbox\" class=\"form-control input-sm\" onChange=\"onChange_CapNhatChiSo(" + data.MA_SO_NV + ",this,'TienThuong')\" value='" + data.TIEN_THUONG + "'>";
                }
            },
            /*******************************/

            ///65
            {
                "data": {}, "render": function (data) {
                    return "<span style=\"display: none;\">" + data.TIEN_THUONG_KHAC + "</span>" +
                        "<input type=\"textbox\" class=\"form-control input-sm\" onChange=\"onChange_CapNhatChiSo(" + data.MA_SO_NV + ",this,'TienThuongKhac')\" value='" + data.TIEN_THUONG_KHAC + "'>";
                }
            },
            /*******************************/

            ///66
            {
                "data": {}, "render": function (data) {
                    return "<span style=\"display: none;\">" + data.PC_KHAC + "</span>" +
                        "<input type=\"textbox\" class=\"form-control input-sm\" onChange=\"onChange_CapNhatChiSo(" + data.MA_SO_NV + ",this,'PCKhac')\" value='" + data.PC_KHAC + "'>";
                }
            },
            /*******************************/

            ///67
            {
                "data": {}, "render": function (data) {
                    return "<span style=\"display: none;\">" + data.DOI_CHIEU + "</span>" +
                        "<input type=\"textbox\" class=\"form-control input-sm\" onChange=\"onChange_CapNhatChiSo(" + data.MA_SO_NV + ",this,'DoiChieu')\" value='" + data.DOI_CHIEU + "'>";
                }
            },
            /*******************************/

            ///68
            {
                "data": {}, "render": function (data) {
                    return "<span style=\"display: none;\">" + data.GHI_CHU + "</span>" +
                        "<input type=\"textbox\" class=\"form-control input-sm\" onChange=\"onChange_CapNhatChiSo(" + data.MA_SO_NV + ",this,'GhiChu')\" value='" + data.GHI_CHU + "'>";
                }
            },
            /*******************************/

            ///69
            {
                "data": {}, "render": function (data) {
                    return data.NGAY_THUA_R;
                }
            },
            ///70
            {
                "data": {}, "render": function (data) {
                    return "<span style=\"display: none;\">" + data.NGAY_THUA_E + "</span>" +
                        "<input type=\"textbox\" class=\"form-control input-sm\" onChange=\"onChange_CapNhatChiSo(" + data.MA_SO_NV + ",this,'WDRE')\" value='" + data.NGAY_THUA_E + "'>";
                }
            },
            /*******************************/
            ///71
            {
                "data": {}, "render": function (data) {
                    return data.LOAI_BHXH;
                }
            }
        ];

        function keypressHandler(e) {
            if (e.which == 13) {
                e.preventDefault(); //stops default action: submitting form
                $(this).blur();
                $('#btnSearch').focus().click();//give your submit an ID
            }
        }
        $("#UserFullName").focusout(function () {
            if ($(this).val() == "") {
                $("#UserEnrollNumber").val("");
            }
        });
        $('.form-search').keypress(keypressHandler);

        $('.timepicker').datepicker({ format: 'dd/mm/yyyy' });

        //Reload_DataTable("table-data", _columns, "/hcns/chamcong/TongHopCong_View?from=" + encodeURIComponent($("#sdate").val()) + "&to=" + encodeURIComponent($("#edate").val()) + "&kp=" + $("#Department option:selected").val() + "&user=" + $("#UserFullName").val().trim() + "&loainv=" + $("#loainv option:selected").val());

        $("#btnSearch").click(function () {
            var _from = $("#sdate").val();
            var _to = $("#edate").val();

            var startDate = new Date(formatDate(_from));
            var endDate = new Date(formatDate(_to));
            var songay = (endDate - startDate) / 1000 / 60 / 60 / 24;

            if (songay >= 32) {
                $(this).callToast("error", 'Cảnh báo', "Không được chọn khoảng tìm kiếm quá 32 ngày.");
                return;
            }
            Reload_DataTable("table-data", _columns, "/hcns/chamcong/TongHopCong_View?from=" + encodeURIComponent($("#sdate").val()) + "&to=" + encodeURIComponent($("#edate").val()) + "&kp=" + $("#Department option:selected").val() + "&user=" + $("#UserFullName").val().trim() + "&loainv=" + $("#loainv option:selected").val());
        });

        function formatDate(str) {
            var d = str.split("/")[0];
            var m = str.split("/")[1];
            var y = str.split("/")[2];
            var date = m + "/" + d + "/" + y

            var d = new Date(date),
                month = '' + (d.getMonth() + 1),
                day = '' + d.getDate(),
                year = d.getFullYear();

            if (month.length < 2) month = '0' + month;
            if (day.length < 2) day = '0' + day;

            return [year, month, day].join('/');
        }

        function Reload_DataTable(id, columns, source) {
            id = "#" + id;
            if ($.fn.dataTable.isDataTable(id)) {
                $(id).DataTable().destroy();
                $(id).find('tbody').empty();
            }
            $('#table-data tfoot th.wsearch').each(function () {
                var title = $(this).text();
                $(this).html('<input type="text" class="form-control" style=\"min-width: 60px;\" />');
            });
            var _tabledata = $(id).DataTable({
                "ajax": {
                    "url": source,
                    "type": "GET",
                    "datatype": "json",
                },
                "pageLength": 20,
                "autoWidth": true,
                "processing": true,
                "columns": columns,
                "deferRender": false,
                "columnDefs": [{
                    "targets": 'no-sort',
                    "orderable": false
                }],
                "drawCallback": function () {
                    //$('[data-toggle="tooltip"]').tooltip();
                },
                "createdRow": function (row, data, dataIndex) {
                    // Set the data-status attribute, and add a class
                    $(row)
                        .attr('data-toggle', "tooltip")
                        .attr('data-placement', "top")
                        .attr('title', data.MA_NV + " | " + data.HO_TEN)
                        .attr("style", "background-color: " + (data.KiemTraBuThua == 0 ? "white" : "#ffbcbc"));
                },
                //"scrollX": true,
                //"scrollCollapse": true,
                //"fixedColumns": {
                //    leftColumns: 4
                //},
                "language": {
                    "sProcessing": "Đang tải dữ liệu...",
                    "sLengthMenu": "Xem _MENU_ mục",
                    "sZeroRecords": "Không tìm thấy dòng nào phù hợp",
                    "sInfo": "Đang xem _START_ đến _END_ trong tổng số _TOTAL_ mục",
                    "sInfoEmpty": "Đang xem 0 đến 0 trong tổng số 0 mục",
                    "sInfoFiltered": "(được lọc từ _MAX_ mục)",
                    "sInfoPostFix": "",
                    "sSearch": "Tìm:",
                    "sUrl": "",
                    "oPaginate": {
                        "sFirst": "Đầu",
                        "sPrevious": "Trước",
                        "sNext": "Tiếp",
                        "sLast": "Cuối"
                    }
                }
            });
            _tabledata.on('page.dt order.dt draw.dt', function () {
                _tabledata.column(0, { search: 'applied', order: 'applied', page: 'current' }).nodes().each(function (cell, i) {
                    cell.innerHTML = i + 1 + _tabledata.page.info().start;
                });
            }).draw();
            _tabledata.columns().every(function () {
                var that = this;
                $('input', this.footer()).on('keyup change clear', function () {
                    if (that.search() !== this.value) {
                        that
                            .search(this.value)
                            .draw();
                    }
                });
            });

            $(id).on('processing.dt', function (e, settings, processing) {
                $('#processingIndicator').css('display', processing ? 'block' : 'none');
            }).dataTable();
        }
    });
    $(function () {
        $('#table-data').DataTable();

        $('#table-data tbody').on('click', 'tr', function () {
            if ($(this).hasClass('selected')) {
                $(this).removeClass('selected');
            }
            else {
                $("#table-data").find($('tr.selected')).removeClass('selected');
                $(this).addClass('selected');
            }
        });

        var stickyHeaderTop = $('#table-data').offset().top;

        $(window).scroll(function () {
            if ($(window).scrollTop() > stickyHeaderTop) {
                $('.dataTables_scrollHead, .DTFC_LeftHeadWrapper').css('transform', 'translateY(0%)');
                $('.DTFC_LeftHeadWrapper').css({ position: 'fixed', top: '0px', zIndex: '1', left: 'auto' });
                $('.dataTables_scrollHead').css({ position: 'fixed', top: '0px', zIndex: '1' });
                $('.DTFC_ScrollWrapper').css({ height: '' });

            }
            else {
                $('.DTFC_LeftHeadWrapper, .DTFC_LeftHeadWrapper').css({ position: 'relative', top: '0px' });
                $('.dataTables_scrollHead').css({ position: 'relative', top: '0px' });
                $('.dataTables_scrollHead').css('transform', 'translateY(0%)');
            }
        });

        $(".dataTables_scrollBody").find("thead tr:nth-child(2)").remove();
    });

// Check the initial Poistion of the Sticky Header

</script>